# AI Architecture Development Guide

**–ü—Ä–æ–µ–∫—Ç:** DAOsail Prototype - Next.js App
**–¶–µ–ª—å:** –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –ò–ò-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-16
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üéØ –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –ò–ò-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ: Chat Completions API vs Assistant API

**–í—ã–±—Ä–∞–Ω –ø–æ–¥—Ö–æ–¥:** Chat Completions API —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
- –ì–∏–±–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RAG —Å–∏—Å—Ç–µ–º–æ–π
- –†–æ–ª—å-–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- –õ—É—á—à–∞—è —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å (–ø–ª–∞—Ç–∏–º —Ç–æ–ª—å–∫–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã)

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ OpenAI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã = —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–æ–º–ø—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –ò—Å—Ç–æ—á–Ω–∏–∫ –ª—É—á—à–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥
- –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —á–µ—Ä–µ–∑ Assistant API

---

## üß† –ö–æ–Ω—Ü–µ–ø—Ü–∏—è "–®–∫–∏–ø–µ—Ä-–ü–∞—Ä—Ç–Ω–µ—Ä" –∫–∞–∫ –º–µ—Ç–∞-–ò–ò

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏:

```
–®–∫–∏–ø–µ—Ä-–ü–∞—Ä—Ç–Ω–µ—Ä (–º–µ—Ç–∞-–ò–ò)
    ‚Üì
–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç: —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞ + –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    ‚Üì
–í—ã–±–∏—Ä–∞–µ—Ç: –∫–∞–∫–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
    ‚Üì
–§–æ—Ä–º–∏—Ä—É–µ—Ç: –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è
    ‚Üì
–ù–∞–≤–∏–≥–∞—Ç–æ—Ä/–®–∫–∏–ø–µ—Ä/–¢—Ä–µ–Ω–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
1. **–®–∫–∏–ø–µ—Ä-–ü–∞—Ä—Ç–Ω–µ—Ä** = –æ—Ç–¥–µ–ª—å–Ω—ã–π API endpoint `/api/skipper-partner`
2. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Üí –≤—ã–±–æ—Ä –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ ‚Üí –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç
3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
   - –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ò–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π—Å—è/–ü–∞—Å—Å–∞–∂–∏—Ä/–ú–∞—Ç—Ä–æ—Å/–ü–∞—Ä—Ç–Ω–µ—Ä)
   - –ë–∞–∑—ã –∑–Ω–∞–Ω–∏–π —Å —Ä–æ–ª—å-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
   - –ò—Å—Ç–æ—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
   - –¢–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–µ—Å—Å–∏–∏

---

## üìà –≠–≤–æ–ª—é—Ü–∏—è –ò–ò-—Å–∏—Å—Ç–µ–º—ã (—Ñ–∞–∑—ã —Ä–∞–∑–≤–∏—Ç–∏—è)

### **–§–∞–∑–∞ 1: –°—Ç–∞—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)**
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –ù–∞–≤–∏–≥–∞—Ç–æ—Ä–∞ –∏ –®–∫–∏–ø–µ—Ä–∞
- –†–æ–ª—å-–æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–Ω–∞–Ω–∏–π
- –ë–∞–∑–æ–≤–∞—è RAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### **–§–∞–∑–∞ 2: –®–∫–∏–ø–µ—Ä-–ü–∞—Ä—Ç–Ω–µ—Ä –∫–∞–∫ –¥–∏—Ä–∏–∂–µ—Ä (—Å–ª–µ–¥—É—é—â–∞—è —Ü–µ–ª—å)**
- –ú–µ—Ç–∞-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–æ–¥ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### **–§–∞–∑–∞ 3: –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è**
- –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤

### **–§–∞–∑–∞ 4: –°–∞–º–æ–æ–±—É—á–∞—é—â–∏–µ—Å—è –ø—Ä–æ–º–ø—Ç—ã**
- –ò–ò —Å–∞–º –ø–∏—à–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö –ò–ò
- –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## üîß –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–§–∞–∑–∞ 1)

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
/app/api/chat/route.ts           # –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç API
/lib/services/chat-service.ts    # ChatService —Å —Ä–æ–ª—å-–ª–æ–≥–∏–∫–æ–π
/lib/services/embedding-service.ts # RAG —Å–∏—Å—Ç–µ–º–∞ —Å —Ä–æ–ª—å-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
```

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç (–ø—Ä–∏–º–µ—Ä):
1. –û—Ç–∫—Ä—ã—Ç—å `/app/api/chat/route.ts`
2. –ù–∞–π—Ç–∏ `baseSystemPrompts`
3. –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞:

```typescript
// –ë–´–õ–û:
navigator: {
  ru: `–¢—ã - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä DAOsail, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–∞—Ä—É—Å–Ω–æ–º—É —Å–ø–æ—Ä—Ç—É...`
}

// –°–¢–ê–õ–û:
navigator: {
  ru: `–¢—ã - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä DAOsail, –æ–ø—ã—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–∞—Ä—É—Å–Ω–æ–≥–æ —Å–ø–æ—Ä—Ç–∞.
  –û—Ç–≤–µ—á–∞–π –ø—Ä–æ—â–µ, —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –í—Å–µ–≥–¥–∞ —Å–ø—Ä–∞—à–∏–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã...`
}
```

---

## üéØ –ü–ª–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –§–∞–∑–µ 2

### –°–æ–∑–¥–∞—Ç—å –®–∫–∏–ø–µ—Ä-–ü–∞—Ä—Ç–Ω–µ—Ä API:
1. **–ù–æ–≤—ã–π endpoint:** `/api/skipper-partner`
2. **–õ–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:** —Ä–æ–ª—å + –≤–æ–ø—Ä–æ—Å + –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí –≤—ã–±–æ—Ä –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
3. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã:** –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –æ–±–Ω–æ–≤–∏—Ç—å ChatService –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–∞-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- **SkipperPartnerService** - –º–µ—Ç–∞-–ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
- **PromptGenerator** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
- **ContextAnalyzer** - –∞–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–ø—Ä–æ—Å–∞
- **AssistantRouter** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫ –Ω—É–∂–Ω–æ–º—É –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É

---

## üí° –ò–¥–µ–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è

### –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:
- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–∞ –ø–æ–¥ —Ä–æ–ª—å
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—à–ª—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ä–æ–ª—è–º
- –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üìù –ó–∞–º–µ—Ç–∫–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é

*–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∏–¥–µ–π –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∞–∑*

**2025-09-16:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Chat Completions vs Assistant API
- –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –®–∫–∏–ø–µ—Ä-–ü–∞—Ä—Ç–Ω–µ—Ä –∫–∞–∫ –º–µ—Ç–∞-–ò–ò
- –ü–ª–∞–Ω —ç–≤–æ–ª—é—Ü–∏–∏ –≤ 4 —Ñ–∞–∑—ã

---

*–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è –ò–ò-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã*
*–°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –§–∞–∑–µ 2*