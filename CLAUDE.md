# Claude Code Working Instructions

**–ü—Ä–æ–µ–∫—Ç:** DAOsail Prototype - Next.js App  
**–¶–µ–ª—å:** –ú–µ—Ç–∞-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å DAOsail –ø—Ä–æ–µ–∫—Ç–æ–º  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-14
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-02 (v0.8.3 - Steward RAG Integration –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)

---

## üéØ –ü–µ—Ä–≤—ã–µ —à–∞–≥–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:
1. **PROJECT_ARCHITECTURE.md** - üéØ –ï–î–ò–ù–´–ô –ë–≠–ö–õ–û–ì, –ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
2. **package.json** - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
3. **README.md** - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

### ‚ö†Ô∏è –ï–î–ò–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö –ò–°–¢–ò–ù–´ –î–õ–Ø –ë–≠–ö–õ–û–ì–ê:
**–¢–û–õ–¨–ö–û PROJECT_ARCHITECTURE.md —Ä–∞–∑–¥–µ–ª "Current Implementation Status"**
- –í—Å–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –≤ PROJECT_ARCHITECTURE.md
- –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö - PROJECT_ARCHITECTURE.md –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### –ë—ã—Å—Ç—Ä–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:
```bash
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
PROJECT_ARCHITECTURE.md       # üéØ –ï–î–ò–ù–´–ô –ë–≠–ö–õ–û–ì –ò –ü–õ–ê–ù –ü–†–û–ï–ö–¢–ê
app/                          # Next.js App Router —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
components/                   # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ layout/                   # Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ ui/                       # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ chat-box.tsx          # –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç —Å –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ citations-display.tsx # –ü–æ–∫–∞–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ FAQ (NEW v0.8.1)
‚îÇ   ‚îú‚îÄ‚îÄ email-capture.tsx     # –§–æ—Ä–º–∞ –∑–∞—Ö–≤–∞—Ç–∞ email –¥–ª—è –≥–æ—Å—Ç–µ–π (NEW v0.5.0)
‚îÇ   ‚îî‚îÄ‚îÄ ...                   # –î—Ä—É–≥–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
lib/                          # –£—Ç–∏–ª–∏—Ç—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
‚îú‚îÄ‚îÄ contexts/app-context.tsx  # –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ utils.ts                  # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
data/                         # –ú–æ–∫–∏ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
package.json                  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
tailwind.config.ts            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind CSS
```

---

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã

### üö´ –ù–ò–ö–û–ì–î–ê –ù–ï –î–ï–õ–ê–¢–¨:
- **–ù–∞—Ä—É—à–∞—Ç—å App Router —Å—Ç—Ä—É–∫—Ç—É—Ä—É** Next.js 13+
- **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å TypeScript —Ç–∏–ø—ã** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
- **–°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –¥–∏—Ä–µ–∫—Ç–∏–≤—ã** ('use client') —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ
- **–ó–∞–±—ã–≤–∞—Ç—å –ø—Ä–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** (accessibility) –≤ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** (ru/en) –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### ‚úÖ –í–°–ï–ì–î–ê –î–ï–õ–ê–¢–¨:
- **–ß–∏—Ç–∞—Ç—å PROJECT_ARCHITECTURE.md** –ø–µ—Ä–µ–¥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- **–°–ª–µ–¥–æ–≤–∞—Ç—å –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞** (Radix UI, Tailwind CSS, TypeScript)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** (App Context, UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ shadcn/ui)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** –≤ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å responsive –¥–∏–∑–∞–π–Ω** –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

---

## üîß –†–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
```
1. –ê–Ω–∞–ª–∏–∑ ‚Üí –∏–∑—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ components/ui/
2. –°–æ–∑–¥–∞–Ω–∏–µ ‚Üí —Å–ª–µ–¥—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–µ shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. –¢–∏–ø–∏–∑–∞—Ü–∏—è ‚Üí —Å—Ç—Ä–æ–≥–∏–µ TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
4. –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ru/en —á–µ—Ä–µ–∑ useAppContext
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–∞—Ö —ç–∫—Ä–∞–Ω–∞
```

### –†–∞–±–æ—Ç–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:
```
1. –ò—Å–ø–æ–ª—å–∑—É–π AppContext –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ useState –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
4. –¢–∏–ø–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
```
1. –†–æ—É—Ç–∏–Ω–≥ ‚Üí Next.js App Router (app/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è)
2. –°–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí React Context API (AppContext)
3. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Üí Radix UI + Tailwind CSS
4. –ò–∫–æ–Ω–∫–∏ ‚Üí Lucide React
5. –¢–∏–ø–∏–∑–∞—Ü–∏—è ‚Üí —Å—Ç—Ä–æ–≥–∏–π TypeScript
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### Next.js App Router:
- **File-based routing:** app/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–æ—É—Ç–∏–Ω–≥–∞
- **Layout —Å–∏—Å—Ç–µ–º–∞:** layout.tsx —Ñ–∞–π–ª—ã –¥–ª—è –æ–±—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- **Server/Client Components:** —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ 'use client' –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏
- **Metadata API:** –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SEO –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### Component Design:
- **Radix UI primitives:** –æ—Å–Ω–æ–≤–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Tailwind CSS:** utility-first –ø–æ–¥—Ö–æ–¥ –∫ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
- **Composition pattern:** –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ slots –∏ props
- **TypeScript interfaces:** —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è props

### State Management:
- **Context API:** –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ AppContext
- **Local state:** useState –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Persistence:** localStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **Error boundaries:** graceful –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### Hydration –æ—à–∏–±–∫–∏:
**–ü—Ä–æ–±–ª–µ–º–∞:** Mismatch –º–µ–∂–¥—É server –∏ client rendering  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π 'use client' –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º  
**–§–∞–π–ª:** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `components/ui/`

### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—Å—Ç—ã –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –º–µ–∂–¥—É ru/en  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ useAppContext.language  
**–ü–∞—Ç—Ç–µ—Ä–Ω:** `{language === 'ru' ? '–¢–µ–∫—Å—Ç' : 'Text'}`

### –°—Ç–∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è:
**–ü—Ä–æ–±–ª–µ–º–∞:** Tailwind –∫–ª–∞—Å—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å tailwind.config.ts –∏ content paths  
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ñ–∞–π–ª—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ content array

### TypeScript –æ—à–∏–±–∫–∏:
**–ü—Ä–æ–±–ª–µ–º–∞:** Type mismatches –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–æ–≥–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è props  
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –†–∞–¥ix UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã

---

## üìã –ß–µ–∫–ª–∏—Å—Ç—ã –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞—á

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
- [ ] –°–æ–∑–¥–∞—Ç—å –≤ components/ui/ —Å TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å 'use client' –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Radix UI primitives –∫–∞–∫ –æ—Å–Ω–æ–≤—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç–∏ (ru/en)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å responsive –¥–∏–∑–∞–π–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å accessibility –∞—Ç—Ä–∏–±—É—Ç—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å props –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- [ ] –°–æ–∑–¥–∞—Ç—å page.tsx –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π app/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å layout.tsx –µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π layout
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ generateMetadata
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–∏–Ω–≥ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã

### –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å AppContextType –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ AppProvider
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ localStorage –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö —á–µ—Ä–µ–∑ useAppContext

---

## üîç –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å hydration –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
// –û—à–∏–±–∫–∏ –≤–∏–¥–∞ "Text content did not match"

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å 'use client' –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º–∏
```

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —è–∑—ã–∫–∞
const { language } = useAppContext();
console.log('Current language:', language);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage
localStorage.getItem('language')
```

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–æ —Å—Ç–∏–ª—è–º–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Tailwind –∫–æ–º–ø–∏–ª—è—Ü–∏—é
npm run dev

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å content –≤ tailwind.config.ts
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –≤–∫–ª—é—á–µ–Ω—ã
```

---

## üìä –í–∞–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Next.js:
- **Bundle size:** –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ webpack-analyzer
- **Core Web Vitals:** LCP, FID, CLS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **Image optimization:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å next/image

### React:
- **Re-renders:** –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É Context
- **Component splitting:** –ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ UI/Layout
- **Memory leaks:** –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ useEffect

### Frontend:
- **Responsive design:** mobile-first –ø–æ–¥—Ö–æ–¥
- **Accessibility:** WCAG compliance
- **TypeScript:** strict —Ä–µ–∂–∏–º, –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è

---

## üöÄ –®–∞–±–ª–æ–Ω—ã –∫–æ–¥–∞

### –ù–æ–≤—ã–π UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
```typescript
'use client';

import React from 'react';
import { useAppContext } from '@/lib/contexts/app-context';

interface MyComponentProps {
  title: string;
  onAction?: () => void;
}

export function MyComponent({ title, onAction }: MyComponentProps) {
  const { language } = useAppContext();
  
  return (
    <div className="p-4 border rounded-lg">
      <h3 className="text-lg font-semibold">
        {language === 'ru' ? '–ó–∞–≥–æ–ª–æ–≤–æ–∫' : 'Title'}: {title}
      </h3>
      {onAction && (
        <button onClick={onAction} className="mt-2 px-4 py-2 bg-primary text-white rounded">
          {language === 'ru' ? '–î–µ–π—Å—Ç–≤–∏–µ' : 'Action'}
        </button>
      )}
    </div>
  );
}
```

### –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–µ—Ç–æ–¥:
```typescript
const updateSettings = (newSettings: Partial<Settings>) => {
  setSettings(prev => ({ ...prev, ...newSettings }));
  
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
  if (typeof window !== 'undefined') {
    localStorage.setItem('settings', JSON.stringify({ ...settings, ...newSettings }));
  }
};
```

---

## üìù –ó–∞–º–µ—Ç–∫–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é

### –°–ª–µ–¥—É—é—â–∏–µ —Ñ–∏—á–∏ (–∏–∑ PROJECT_ARCHITECTURE.md):
- File upload –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º
- Function calling –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤  
- Export/import —á–∞—Ç–æ–≤
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è bundle size
- Code splitting –¥–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –£–ª—É—á—à–µ–Ω–∏–µ error boundaries

---

## üîÑ –°–ø—Ä–∏–Ω—Ç–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ –∏ —Ü–∏–∫–ª—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø—Ä–∏–Ω—Ç–∞:
```
üéØ –ù–ê–ß–ê–õ–û –°–ü–†–ò–ù–¢–ê
‚îú‚îÄ‚îÄ "–î–∞–≤–∞–π –¥–æ–±–∞–≤–∏–º/–∏–∑–º–µ–Ω–∏–º X"
‚îú‚îÄ‚îÄ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (TodoWrite)
‚îú‚îÄ‚îÄ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏
‚îú‚îÄ‚îÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç–∫–∞—Ç—ã
‚îî‚îÄ‚îÄ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

üìã –ó–ê–í–ï–†–®–ï–ù–ò–ï –°–ü–†–ò–ù–¢–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–∏—Ç—å PROJECT_ARCHITECTURE.md
‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–∏—Ç—å DATABASE_CHANGELOG.md (–µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ë–î)
‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–∏—Ç—å CLAUDE.md (–Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞/–æ—à–∏–±–∫–∏)
‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–∏—Ç—å README.md (–≤–µ—Ä—Å–∏—è + –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ –ö–æ–º–º–∏—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ üéâ –ú–∏–Ω–æ—Ä–Ω—ã–π —Ä–µ–ª–∏–∑ –≥–æ—Ç–æ–≤
```

### üö® –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–≤–µ—Ä—à–∞—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–ø—Ä–∏–Ω—Ç–∞

**–ù–ò–ö–û–ì–î–ê –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–π —Å–ø—Ä–∏–Ω—Ç –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏!**

#### –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ø—Ä–∏–Ω—Ç–∞:
- [ ] **PROJECT_ARCHITECTURE.md** - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] **DATABASE_CHANGELOG.md** - –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ë–î
- [ ] **CLAUDE.md** - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞/–æ—à–∏–±–∫–∏ –∏–∑ —Å–ø—Ä–∏–Ω—Ç–∞  
- [ ] **README.md** - –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] **Git commit** - —Å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–ø—Ä–∏–Ω—Ç–∞
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ TodoWrite –∑–∞–¥–∞—á–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ completed

#### –®–∞–±–ª–æ–Ω –∫–æ–º–º–∏—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ø—Ä–∏–Ω—Ç–∞:
```bash
git add .
git commit -m "Sprint: [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏—á–∏]

- Implemented: [–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å]  
- Updated: PROJECT_ARCHITECTURE.md, DATABASE_CHANGELOG.md
- Fixed: [–µ—Å–ª–∏ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è]
- Docs: –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

ü§ñ Generated with Claude Code

Co-Authored-By: Claude <noreply@anthropic.com>"
```

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ø—Ä–∏–Ω—Ç–∞–º–∏:

#### –°–ø—Ä–∏–Ω—Ç —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ë–î:
```
1. –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
2. –¢–µ—Å—Ç –≤ dev  
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ TypeScript
4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ
5. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: DATABASE_CHANGELOG.md
6. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: PROJECT_ARCHITECTURE.md
```

#### –°–ø—Ä–∏–Ω—Ç —Å –Ω–æ–≤–æ–π —Ñ–∏—á–µ–π:
```
1. –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—á–∏—Ç–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã)
2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è  
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: PROJECT_ARCHITECTURE.md (–Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
6. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: CLAUDE.md (–Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞)
```

#### –°–ø—Ä–∏–Ω—Ç —Å –±–∞–≥—Ñ–∏–∫—Å–æ–º:
```
1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  
4. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: CLAUDE.md (–¥–æ–±–∞–≤–∏—Ç—å –≤ "–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã")
5. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: README.md (–æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é)
```

### üéØ –¶–µ–ª–∏ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã:
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞** 
- **–ö–∞–∂–¥—ã–π —Å–ø—Ä–∏–Ω—Ç = –º–∏–Ω–æ—Ä–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ**
- **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏–π** –≤ CLAUDE.md
- **Git –∏—Å—Ç–æ—Ä–∏—è** –æ—Ç—Ä–∞–∂–∞–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞** –∫ –ª—é–±–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–º—É —Å–ø—Ä–∏–Ω—Ç—É

---

## üéØ –°—Ç–∏–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

**–§–æ—Ä–º—É–ª–∞:** –∑–∞–¥–∞—á–∞ ‚Üí –∞–Ω–∞–ª–∏–∑ ‚Üí —Ä–µ—à–µ–Ω–∏–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Üí —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥

### 1) –ó–∞–¥–∞—á–∞
- –§–æ—Ä–º—É–ª–∏—Ä—É–µ–º –µ–¥–∏–Ω–∏—á–Ω—É—é —Ü–µ–ª—å (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã)
- –§–∏–∫—Å–∏—Ä—É–µ–º –≤—Ö–æ–¥—ã: —á—Ç–æ —É–∂–µ –µ—Å—Ç—å, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 2) –ê–Ω–∞–ª–∏–∑  
- –ö–æ—Ä–æ—Ç–∫–æ: –≤–∞—Ä–∏–∞–Ω—Ç—ã, —Ä–∏—Å–∫–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤—è–∑—å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º PROJECT_ARCHITECTURE.md

### 3) –†–µ—à–µ–Ω–∏–µ
- –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤–∏—á–∫–∞ (–º–∞–∫—Å–∏–º—É–º –ø—Ä–æ—Å—Ç–æ—Ç—ã)
- –ì–æ—Ç–æ–≤—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: —Ç–µ–∫—Å—Ç, –∫–æ–¥, —Ñ–∞–π–ª—ã, –∫–æ–º–∞–Ω–¥—ã, —á–µ–∫-–ª–∏—Å—Ç

### 4) –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –ß—Ç–æ —Å—á–∏—Ç–∞—Ç—å —É—Å–ø–µ—Ö–æ–º? (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏/—Å–∫—Ä–∏–Ω/–ª–æ–≥)
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –∫—Ä–∞—Ç–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Ñ–∏–∫—Å

### 5) –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥
- –û–¥–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞, –≤—ã—Ç–µ–∫–∞—é—â–∞—è –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –ù–∏–∫–∞–∫–∏—Ö ¬´–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–µ—Ç–æ–∫¬ª, –ø–æ–∫–∞ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- –û–¥–∏–Ω —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –±–µ–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–µ—Ç–æ–∫
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

## üÜï –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 0.7.0 (2025-01-22)

### –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ React hooks** –≤ LeftSidebar - useEffect –≤—ã–Ω–µ—Å–µ–Ω –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ù–∞—à–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞"** (`/communities`) —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞
- **CommunityCard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (`components/ui/community-card.tsx`) —Å tooltip –∏ external links
- **–†–∞–∑–¥–µ–ª "–û –∫–ª—É–±–µ"** –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É Chat –∏ Yachting —Å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞–º–∏
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π** (`/about/concepts`) —Å 7 –∫–ª—é—á–µ–≤—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞
- **ConceptCard –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (`components/ui/concept-card.tsx`) —Å —Ü–≤–µ—Ç–æ–≤–æ–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–µ–π

### –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **data/menu.ts**: –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª "About Club" —Å –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º "Concepts & Presentations"
- **Tooltip integration**: –ø–æ–ª–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
- **Accessibility —É–ª—É—á—à–µ–Ω–∏—è**: keyboard navigation –∏ screen reader support
- **–¶–≤–µ—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (7 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

### –ù–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
```typescript
// –ö–∞—Ä—Ç–æ—á–∫–∞ —Å tooltip –∏ external link
<CommunityCard
  icon={Send}
  title="Telegram Chat"
  description="Main channel for breaking news..."
  link="https://t.me/daosailnews"
  color="telegram"
/>

// –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ —Å —Ü–≤–µ—Ç–æ–≤–æ–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏–µ–π
<ConceptCard
  icon={Lightbulb}
  title="Project Concept"
  description="Interactive presentation..."
  link="https://concept.daosail.com/"
  color="concept"
/>

// Tooltip –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è
<Tooltip>
  <TooltipTrigger asChild>
    <p className="line-clamp-3 cursor-help">{description}</p>
  </TooltipTrigger>
  <TooltipContent className="max-w-sm p-3">
    <p>{description}</p>
  </TooltipContent>
</Tooltip>
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **React hooks –ø—Ä–∞–≤–∏–ª–∞**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –ø–æ—Ä—è–¥–∫–∞ —Ö—É–∫–æ–≤ –≤ —Ä–µ–Ω–¥–µ—Ä-—Ñ—É–Ω–∫—Ü–∏—è—Ö
- **External links –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `noopener,noreferrer` –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫
- **Keyboard accessibility**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Enter/Space –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫-–∫–Ω–æ–ø–æ–∫

---

## üÜï –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 0.7.2 (2025-01-24)

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:
- **REVIEW.md driven development** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ production checklist –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **ENV validation patterns** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —É—Ç–∏–ª–∏—Ç—ã:

```typescript
// lib/utils/env-validation.ts - –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
export function validateOpenAI(): string {
  const apiKey = process.env.OPENAI_API_KEY;
  if (!apiKey?.startsWith('sk-')) {
    throw new Error('Invalid OPENAI_API_KEY format');
  }
  return apiKey;
}

// lib/utils/cors.ts - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ CORS headers
export function getCorsHeaders(origin?: string | null): Record<string, string> {
  const allowedOrigins = ['http://localhost:3000', process.env.NEXT_PUBLIC_APP_URL];
  const isAllowedOrigin = origin && allowedOrigins.includes(origin);
  return {
    'Access-Control-Allow-Origin': isAllowedOrigin ? origin : 'http://localhost:3000'
  };
}
```

### –í–∞–∂–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **TypeScript target**: ES5 ‚Üí ES2015 –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- **AssistantType standardization**: –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ enum –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫
- **Migration consolidation**: –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `supabase/migrations/`
- **.env.example security**: —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π –∏–∑ –ø—Ä–∏–º–µ—Ä–∞

### npm scripts patterns:
```json
{
  "typecheck": "tsc --noEmit",           // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
  "audit": "npm audit --production --audit-level=high",  // –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  "analyze:deps": "depcheck",            // –ü–æ–∏—Å–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  "analyze:unused": "ts-prune"           // –ü–æ–∏—Å–∫ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞
}
```

### –°–ø—Ä–∏–Ω—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:
```
üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ï–ö–¢–ê
‚îú‚îÄ‚îÄ –ì–ª—É–±–æ–∫–æ–µ –∏–∑—É—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Task agent)
‚îú‚îÄ‚îÄ –í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∏ —É–ª—É—á—à–µ–Ω–∏–π
‚îú‚îÄ‚îÄ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

üìã –î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–ù–ò–ï
‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ PROJECT_ARCHITECTURE.md
‚îú‚îÄ‚îÄ –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ CLAUDE.md –Ω–æ–≤—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ production checklist (REVIEW.md)
‚îî‚îÄ‚îÄ Professional README.md

üîß –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê
‚îú‚îÄ‚îÄ ENV validation utilities
‚îú‚îÄ‚îÄ CORS security improvements
‚îú‚îÄ‚îÄ Development tools installation
‚îî‚îÄ‚îÄ TypeScript configuration optimization
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è v0.7.2:

**TypeScript target mismatch:**
**–ü—Ä–æ–±–ª–µ–º–∞:** `Type 'Set<string>' can only be iterated through when using the '--downlevelIteration' flag`
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å `tsconfig.json` target —Å `"es5"` –Ω–∞ `"es2015"`

**ENV variables leakage:**
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ `.env.example`
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ placeholder –∑–Ω–∞—á–µ–Ω–∏—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `your_`

**CORS security risk:**
**–ü—Ä–æ–±–ª–µ–º–∞:** `Access-Control-Allow-Origin: '*'` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –≤—Å–µ–º –¥–æ–º–µ–Ω–∞–º
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å whitelist —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins –≤ `lib/utils/cors.ts`

**AssistantType inconsistency:**
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–º–µ—à–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤ –∏ –Ω–æ–≤—ã—Ö enum
**–†–µ—à–µ–Ω–∏–µ:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ `AssistantType` enum –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö

---

## üÜï –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 0.8.1 (2025-09-26)

### FAQ Agent MVP - –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

#### **RAG Architecture Pattern:**
```typescript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ FAQ –∞–≥–µ–Ω—Ç–∞ —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
1. User Query ‚Üí Embedding (OpenAI)
2. Vector Search ‚Üí match_docs(embedding, roles[], similarity)
3. Context Formation ‚Üí —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏ + –∏—Å—Ç–æ—á–Ω–∏–∫–∏
4. LLM Generation ‚Üí —Å—Ç—Ä–æ–≥–∏–π –ø—Ä–æ–º–ø—Ç –±–µ–∑ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π
5. Response + Citations ‚Üí –ø–æ–∫–∞–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

#### **Database Schema Pattern:**
```sql
-- –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
knowledge_chunks: {
  id, doc_id, chunk_idx, text,
  embedding vector(1536),
  accessible_roles text[], -- role-based –¥–æ—Å—Ç—É–ø
  tags text[], url
}

-- –ß–∞—Ç –ª–æ–≥–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
chat_messages: {
  id, session_id, role, content, agent,
  meta jsonb -- citations, trace info
}
```

#### **Edge Function Pattern:**
```typescript
// Supabase Edge Function –¥–ª—è FAQ
supabase/functions/handle-faq/index.ts
‚îú‚îÄ‚îÄ Environment validation
‚îú‚îÄ‚îÄ Embedding generation (OpenAI)
‚îú‚îÄ‚îÄ Vector search (match_docs RPC)
‚îú‚îÄ‚îÄ Context preparation
‚îú‚îÄ‚îÄ LLM response (strict prompt)
‚îî‚îÄ‚îÄ Response with citations
```

#### **Frontend Integration Pattern:**
```typescript
// ChatBox —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π FAQ —Ä–µ–∂–∏–º–∞
if (assistantType === 'faq') {
  const response = await fetch('/api/faq', {
    body: JSON.stringify({
      session_id, user_message,
      user_role, prefs: { lang }
    })
  });
  // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç —Å citations
  const { final_text, citations, trace } = await response.json();
}

// CitationsDisplay –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
<CitationsDisplay
  citations={message.citations}
  traceInfo={message.trace}
/>
```

#### **Prompt Engineering Pattern:**
```typescript
const systemPrompt = `–¢—ã FAQ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç DAOsail ‚Äî —Å—Ç—Ä–æ–≥–∏–π –∏ —Ç–æ—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫.

üéØ –ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û: –û—Ç–≤–µ—á–∞–µ—à—å –¢–û–õ–¨–ö–û –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É. –ù–∏–∫–∞–∫–∏—Ö –≤—ã–¥—É–º–æ–∫!

üìã –ò–ù–°–¢–†–£–ö–¶–ò–ò:
‚Ä¢ –ï—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Üí –æ—Ç–≤–µ—á–∞–π —á–µ—Ç–∫–æ –∏ –∫—Ä–∞—Ç–∫–æ
‚Ä¢ –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ù–ï–¢ ‚Üí "–í –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
‚Ä¢ –°—Å—ã–ª–∞–π—Å—è –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ [1], [2]
‚Ä¢ –¢–æ–Ω: –¥–µ–ª–æ–≤–æ–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π
‚Ä¢ –î–ª–∏–Ω–∞: –º–∞–∫—Å–∏–º—É–º 150 —Å–ª–æ–≤`;
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è v0.8.1:

**Vector extension missing:**
**–ü—Ä–æ–±–ª–µ–º–∞:** `function public.match_docs() does not exist`
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å `FIX_MIGRATION.sql` –≤ Supabase SQL Editor —Å `create extension if not exists vector;`

**Policy syntax error:**
**–ü—Ä–æ–±–ª–µ–º–∞:** `create policy if not exists` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ PostgreSQL
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `drop policy if exists` + `create policy`

**Empty array type error:**
**–ü—Ä–æ–±–ª–µ–º–∞:** `cannot determine type of empty array`
**–†–µ—à–µ–Ω–∏–µ:** –Ø–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø: `array[]::text[]` –≤–º–µ—Å—Ç–æ `array[]`

**Citations –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:**
**–ü—Ä–æ–±–ª–µ–º–∞:** Citations –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `message.citations` –≤ ChatMessage interface –∏ –∏–º–ø–æ—Ä—Ç CitationsDisplay

### Embeddings Pipeline Pattern:
```typescript
// scripts/embeddings/upload-faq.ts
1. –ß–∏—Ç–∞–µ–º .md —Ñ–∞–π–ª—ã
2. –ß–∞–Ω–∫—É–µ–º —Ç–µ–∫—Å—Ç (600 tokens, overlap 100)
3. –ü–æ–ª—É—á–∞–µ–º embeddings (OpenAI ada-002)
4. Upsert –≤ knowledge_chunks —Å —Ä–æ–ª—è–º–∏ –¥–æ—Å—Ç—É–ø–∞
5. Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```

### Testing Pattern:
```javascript
// scripts/test-faq.js - –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. Mock –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
2. –¢–µ—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–≤ —Ç–µ–º–µ + –≤–Ω–µ —Ç–µ–º—ã)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞: –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ vs –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç–∫–∞–∑—ã
4. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ [1], [2]
```

---

## üöÄ Claude 4.5 Capabilities & Next.js Optimizations

**–í–µ—Ä—Å–∏—è –º–æ–¥–µ–ª–∏:** claude-sonnet-4-5-20250929
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:** 2025-01-31

### üéØ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è DAOsail –ø—Ä–æ–µ–∫—Ç–∞

#### 1. Next.js App Router Expertise
**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ Server/Client Components boundaries
- –õ—É—á—à–∏–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É route groups –∏ layouts
- –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ —Å hydration –∏ 'use client' –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –ø—Ä–æ–µ–∫—Ç—É:**
```typescript
// –¢–µ–ø–µ—Ä—å –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—é —Ç–∞–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
app/(auth)/layout.tsx ‚Üí Server Component
  ‚îú‚îÄ‚îÄ app/(auth)/login/page.tsx ‚Üí Server Component
  ‚îî‚îÄ‚îÄ components/ui/email-capture.tsx ‚Üí 'use client' (–µ—Å—Ç—å useState)

// –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
// ‚ùå –ò–∑–±–µ–≥–∞—Ç—å
const ClientComponent = () => {
  const { theme, language, user } = useAppContext(); // re-render –ø—Ä–∏ –õ–Æ–ë–û–ú –∏–∑–º–µ–Ω–µ–Ω–∏–∏
}

// ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ
const ClientComponent = () => {
  const theme = useAppContext(ctx => ctx.theme); // selective subscription
  const language = useAppContext(ctx => ctx.language);
}
```

#### 2. React Context Optimization
**–£–ª—É—á—à–µ–Ω–∏—è:**
- –¢–æ—á–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—è—é –º–µ—Å—Ç–∞ –¥–ª—è context splitting
- –õ—É—á—à–µ —Ä–∞–±–æ—Ç–∞—é —Å Context + localStorage patterns
- –ú–µ–Ω—å—à–µ –ø—Ä–æ–º–∞—Ö–æ–≤ —Å re-render optimization

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è AppContext:**
```typescript
// –ú–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å AppContext –Ω–∞ –º–µ–Ω—å—à–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:
// 1. ThemeContext (theme, toggleTheme)
// 2. AuthContext (user, isAuthenticated, login, logout)
// 3. GuestContext (responsesLeft, guestStage, captureEmail)
// 4. LocaleContext (language, toggleLanguage)

// –≠—Ç–æ —É–º–µ–Ω—å—à–∏—Ç re-renders –∫–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞—Å–ø–µ–∫—Ç
```

#### 3. Database & Supabase Patterns
**–ß—Ç–æ —É–ª—É—á—à–∏–ª–æ—Å—å:**
- –¢–æ—á–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—é —Å RLS policies –∏ PostgreSQL functions
- –õ—É—á—à–µ –ø–æ–Ω–∏–º–∞—é pgvector –∏ RAG architecture
- –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ —Å Supabase TypeScript types

**–ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è DAOsail:**
```typescript
// Type-safe Supabase queries:
const { data: profiles } = await supabase
  .from('profiles')
  .select('id, full_name, nickname, role, avatar_url')
  .eq('role', '–º–∞—Ç—Ä–æ—Å')
  .order('join_date', { ascending: false });

// RLS –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
// CREATE POLICY "Users can only update own profile"
// ON profiles FOR UPDATE
// USING (auth.uid() = id);
```

#### 4. OpenAI API & RAG Best Practices
**–£–ª—É—á—à–µ–Ω–∏—è:**
- –õ—É—á—à–µ –ø–æ–Ω–∏–º–∞—é RAG pipeline optimization
- –¢–æ—á–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—é —Å embeddings –∏ vector search
- –ü—Ä–∞–≤–∏–ª—å–Ω–µ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é streaming responses

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è FAQ Agent:**
```typescript
// –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è vector search:
// 1. Cache embeddings –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
// 2. Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö queries
// 3. Adjustable similarity threshold –ø–æ —Ä–æ–ª—è–º

// Streaming optimization:
const stream = await openai.chat.completions.create({
  model: 'gpt-4o-mini',
  messages: [...],
  stream: true, // ‚Üê –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –ª—É—á—à–µ–≥–æ UX
});
```

#### 5. TypeScript Type Safety
**–ß—Ç–æ —É–ª—É—á—à–∏–ª–æ—Å—å:**
- –¢–æ—á–Ω–µ–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é —Ç–∏–ø—ã –∏–∑ Supabase schema
- –õ—É—á—à–µ —Ä–∞–±–æ—Ç–∞—é —Å discriminated unions (AssistantType)
- –ú–µ–Ω—å—à–µ –ø—Ä–æ–º–∞—Ö–æ–≤ —Å JSONB —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π

**–ü—Ä–∏–º–µ—Ä –¥–ª—è DAOsail:**
```typescript
// –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è chat messages:
type ChatMessage = {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  agent?: AssistantType;
  citations?: Citation[]; // –¥–ª—è FAQ –∞–≥–µ–Ω—Ç–∞
  meta?: {
    trace_id?: string;
    context_used?: boolean;
  };
};

// Type guard –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
function isFAQMessage(msg: ChatMessage): msg is ChatMessage & { citations: Citation[] } {
  return 'citations' in msg && Array.isArray(msg.citations);
}
```

#### 6. Component Performance Patterns
**–ù–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –õ—É—á—à–µ –ø—Ä–∏–º–µ–Ω—è—é React.memo –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –¢–æ—á–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—è—é –º–µ—Å—Ç–∞ –¥–ª—è useMemo/useCallback
- –ú–µ–Ω—å—à–µ –ª–∏—à–Ω–∏—Ö re-renders –≤ —Å–ª–æ–∂–Ω—ã—Ö UI

**–ê–Ω–∞–ª–∏–∑ –¥–ª—è DAOsail:**
```typescript
// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
// 1. ChatBox ‚Üí –º–Ω–æ–≥–æ state, –Ω—É–∂–µ–Ω memo
// 2. AssistantDock ‚Üí scroll events, –Ω—É–∂–Ω–∞ debounce
// 3. ProfileInfoTab ‚Üí real-time updates, selective subscriptions

// –ü—Ä–∏–º–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
const ChatBox = React.memo(({ assistantType, onBack }) => {
  const sendMessage = useCallback((msg: string) => {
    // ... logic
  }, [assistantType]); // –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ

  const messages = useMemo(
    () => filterMessagesByAssistant(allMessages, assistantType),
    [allMessages, assistantType]
  );

  return <div>...</div>;
});
```

### üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –∫ DAOsail

#### –î–ª—è —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á:
- ‚úÖ **Context splitting** - —Ä–∞–∑–¥–µ–ª–∏—Ç—å AppContext –Ω–∞ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
- ‚úÖ **Component memoization** - –¥–æ–±–∞–≤–∏—Ç—å React.memo –∫ ChatBox, AssistantSelector
- ‚úÖ **Type guards** - –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è FAQMessage, ProfileData
- ‚úÖ **Streaming responses** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è –ª—É—á—à–µ–≥–æ UX

#### –î–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á–µ–π (Phase 9+):
- üéØ **Multi-agent orchestration** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å type safety
- üéØ **Advanced caching** - Redis –¥–ª—è embeddings –∏ frequent queries
- üéØ **Real-time optimizations** - Supabase subscriptions —Å debounce
- üéØ **Bundle splitting** - Code splitting –¥–ª—è Route Groups

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è DAOsail

**–ß—Ç–æ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É –¥–µ–ª–∞—Ç—å –ª—É—á—à–µ:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Supabase query performance
- –ù–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å RLS policies –¥–æ runtime
- –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ RAG pipeline
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ hydration errors

### üí° Workflow —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Å–ø—Ä–∏–Ω—Ç–æ–≤

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ DAOsail:**
```
1. –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—Ç–æ—á–Ω–µ–µ –ø–æ–Ω–∏–º–∞—é Next.js patterns)
2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–æ–≤ (–º–µ–Ω—å—à–µ Supabase –æ—à–∏–±–æ–∫)
3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π (Context splitting, memo)
4. –†–µ–≤—å—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (RLS, type guards)
5. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤ CLAUDE.md + PROJECT_ARCHITECTURE.md)
```

### üéØ Priority Optimizations –¥–ª—è DAOsail

#### Quick Wins (1-2 –¥–Ω—è):
1. **React.memo –¥–ª—è ChatBox** - —É–º–µ–Ω—å—à–∏—Ç—å re-renders
2. **Type guards –¥–ª—è FAQ** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å citations
3. **Streaming responses** - —É–ª—É—á—à–∏—Ç—å UX —á–∞—Ç–∞

#### Medium Priority (—Å–ª–µ–¥—É—é—â–∏–µ —Å–ø—Ä–∏–Ω—Ç—ã):
1. **Context splitting** - —Ä–∞–∑–¥–µ–ª–∏—Ç—å AppContext
2. **Vector search cache** - Redis –¥–ª—è embeddings
3. **Component lazy loading** - Code splitting

#### Long Term (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ):
1. **Multi-agent orchestration**
2. **Advanced RAG with reranking**
3. **Performance monitoring dashboard**

---

## üÜï –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 0.8.2 (2025-10-01)

### FAQ Agent Unification - –ü–∞—Ç—Ç–µ—Ä–Ω—ã:

#### **Unified Chunks Table Pattern:**
```typescript
// –û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å–µ—Ö embeddings –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
chunks: {
  id bigserial,
  source text,          // 'docs', 'manual', etc.
  path text,            // 'docs/spec/architecture.md'
  content text,         // —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞
  embedding vector(1536),
  metadata jsonb,       // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  accessible_roles text[] DEFAULT ['public'],  // role-based access
  tags text[] DEFAULT []                       // —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–≥–∏
}

// –í–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã knowledge_chunks
// –ò–∑–±–µ–≥–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ embeddings
```

#### **Role-Based Vector Search Pattern:**
```sql
-- RPC —Ñ—É–Ω–∫—Ü–∏—è —Å role filtering
CREATE FUNCTION match_chunks_docs(
  query_embedding VECTOR(1536),
  match_count INT DEFAULT 8,
  roles TEXT[] DEFAULT ARRAY['public'],
  min_similarity FLOAT DEFAULT 0.75
) RETURNS TABLE (...) AS $$
  SELECT ...
  FROM chunks
  WHERE chunks.accessible_roles && roles  -- PostgreSQL array overlap operator
    AND (1 - (chunks.embedding <=> query_embedding)) >= min_similarity
  ...
$$;
```

#### **Edge Function Migration Pattern:**
```typescript
// –ë—ã–ª–æ (knowledge_chunks):
const { data: matches } = await supabase.rpc('match_docs', {
  query_embedding,
  match_count: 5,
  roles,
  min_similarity: 0.7
});

// –°—Ç–∞–ª–æ (chunks):
const { data: matches } = await supabase.rpc('match_chunks_docs', {
  query_embedding,
  match_count: 5,
  roles: userRoles,
  min_similarity: 0.7
});

// Mapping —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
// match.text ‚Üí match.content
// match.doc_id ‚Üí match.path
// match.chunk_idx ‚Üí match.metadata?.chunk || 0
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è v0.8.2:

**Port mismatch –≤ .env:**
**–ü—Ä–æ–±–ª–µ–º–∞:** NEXT_PUBLIC_APP_URL=http://localhost:3002 –Ω–æ dev —Å–µ—Ä–≤–µ—Ä –Ω–∞ :3000
**–†–µ—à–µ–Ω–∏–µ:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—ã - –ª–∏–±–æ –æ–±–Ω–æ–≤–∏—Ç—å .env.local, –ª–∏–±–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `npm run dev -- -p 3002`
**–§–∞–π–ª:** `.env.local` line 13

**API Error 500 –≤ /api/faq:**
**–ü—Ä–æ–±–ª–µ–º–∞:** POST /api/faq –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Internal Server Error
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. Edge Function –Ω–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º—ã –æ—Ç–≤–µ—Ç–∞ match_chunks_docs
3. CORS –ø—Ä–æ–±–ª–µ–º—ã –∏–∑-–∑–∞ port mismatch
**–†–µ—à–µ–Ω–∏–µ:** Deploy Edge Function: `supabase functions deploy handle-faq --project-ref <project-id>`

**Migration —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –Ω–æ –Ω–µ –≤–∏–¥–Ω–∞ –≤ –∫–æ–¥–µ:**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–¥–µ–∫—Å—ã idx_chunks_accessible_roles —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –Ω–æ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –≤ migrations/
**–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏–∏ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤—Ä—É—á–Ω—É—é –≤ Supabase SQL Editor. –î–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—Ç—å migration —Ñ–∞–π–ª –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º
**–§–∞–π–ª:** `supabase/migrations/20250928000001_add_role_tags_to_chunks.sql` (—É–∂–µ –µ—Å—Ç—å –≤ untracked)

### Database Verification Patterns:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'chunks'
ORDER BY ordinal_position;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT indexname, indexdef
FROM pg_indexes
WHERE tablename = 'chunks';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ RPC —Ñ—É–Ω–∫—Ü–∏–π
SELECT proname, pg_get_function_arguments(oid)
FROM pg_proc
WHERE proname LIKE 'match_%';

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–æ–ª—è–º
SELECT accessible_roles, tags, COUNT(*)
FROM chunks
GROUP BY accessible_roles, tags
LIMIT 10;
```

### Deployment Checklist –¥–ª—è FAQ Agent:

- [ ] –û–±–Ω–æ–≤–∏—Ç—å Edge Function –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (OPENAI_API_KEY, SUPABASE_SERVICE_ROLE_KEY)
- [ ] –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å Edge Function: `supabase functions deploy handle-faq`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Edge Function: `supabase functions logs handle-faq`
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoint: POST /api/faq —Å —Ç–µ—Å—Ç–æ–≤—ã–º –≤–æ–ø—Ä–æ—Å–æ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å citations –≤ UI
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ role-based filtering —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üÜï –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 0.8.3 (2025-10-02)

### Steward RAG Integration - –ü–∞—Ç—Ç–µ—Ä–Ω—ã:

#### **RAG Integration in Streaming API:**
```typescript
// –ü–∞—Ç—Ç–µ—Ä–Ω: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ RAG –ø–æ–∏—Å–∫–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π /api/chat
async function getRelevantContext(
  userMessage: string,
  assistantType: 'navigator' | 'skipper' | 'steward',
  userRole: string,
  language: 'ru' | 'en'
): Promise<{ context: string; chunksUsed: number; citations: any[] }> {

  // –î–ª—è steward –∏—Å–ø–æ–ª—å–∑—É–µ–º RAG –ø–æ–∏—Å–∫
  if (assistantType === 'steward') {
    const { data: matches } = await supabase.rpc('match_chunks_docs', {
      query_embedding: await getEmbedding(userMessage),
      match_count: 5,
      roles: [userRole.toLowerCase(), 'public'],
      min_similarity: 0.7
    });

    // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ citations
    const context = matches.map((m, idx) =>
      `[${idx + 1}] ${m.content}\n(–ò—Å—Ç–æ—á–Ω–∏–∫: ${m.path}, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ${Math.round(m.similarity * 100)}%)`
    ).join('\n\n');

    const citations = matches.map(m => ({
      doc_id: m.path,
      url: null,
      chunk_idx: m.metadata?.chunk || 0,
      similarity: m.similarity
    }));

    return { context, chunksUsed: matches.length, citations };
  }
}
```

#### **Prompt Engineering for Knowledge-Based Assistant:**
```typescript
const stewardPrompt = {
  ru: `–¢—ã - –°—Ç—é–∞—Ä–¥ DAOsail, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫.

  üéØ –ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û: –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

  üìã –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –°–¢–ò–õ–Æ:
  ‚Ä¢ –¢–æ–Ω: —Ç—ë–ø–ª—ã–π, –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π
  ‚Ä¢ –°—Ç–∏–ª—å: –º–æ–∂–µ—à—å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
  ‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –¥–µ–ª–∞–π –æ—Ç–≤–µ—Ç—ã –ø–æ–Ω—è—Ç–Ω—ã–º–∏ (—Å–ø–∏—Å–∫–∏, –∞–±–∑–∞—Ü—ã)
  ‚Ä¢ –°—Å—ã–ª–∫–∏: –º–æ–∂–µ—à—å —É–ø–æ–º–∏–Ω–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ [1], [2]

  ‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
  ‚Ä¢ –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ù–ï–¢ ‚Üí "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É –º–µ–Ω—è –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
  ‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã, –¥–∞—Ç—ã, —Ü–∏—Ñ—Ä—ã
  ‚Ä¢ –ù–ï –¥–æ–±–∞–≤–ª—è–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –æ–±—â–∏—Ö –∑–Ω–∞–Ω–∏–π

  –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:
  ${contextResult.context || '–ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω'}`,
};
```

#### **Citations in Streaming Mode:**
```typescript
// –ü–∞—Ç—Ç–µ—Ä–Ω: –í–æ–∑–≤—Ä–∞—Ç citations –≤ finish event
if (chunk.choices[0]?.finish_reason) {
  const finishData = {
    type: 'finish',
    message: {
      role: 'assistant',
      content: fullContent,
      citations: contextResult.citations || [],  // –î–æ–±–∞–≤–ª—è–µ–º citations
      metadata: {
        knowledgeChunksUsed: contextResult.chunksUsed
      }
    }
  };
  controller.enqueue(encoder.encode(`data: ${JSON.stringify(finishData)}\n\n`));
}
```

#### **Logging Pattern for RAG Debugging:**
```typescript
// –ü–∞—Ç—Ç–µ—Ä–Ω: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
if (assistantType === 'steward') {
  console.log('üîç [STEWARD RAG] Starting search...');
  console.log('üîç [STEWARD RAG] User message:', userMessage.substring(0, 100));
  console.log('üîç [STEWARD RAG] User role:', userRole);
  console.log('üîç [STEWARD RAG] Search roles:', userRoles);

  const { data: matches, error } = await supabase.rpc('match_chunks_docs', {...});

  if (error) {
    console.error('‚ùå [STEWARD RAG] Knowledge search error:', error);
  }

  console.log('üîç [STEWARD RAG] Matches found:', matches?.length || 0);
  console.log('‚úÖ [STEWARD RAG] Top match similarity:', matches[0]?.similarity);
}
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è v0.8.3:

**–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–µ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π:**
**–ü—Ä–æ–±–ª–µ–º–∞:** Steward –æ—Ç–≤–µ—á–∞–µ—Ç –æ–±—â–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∫–æ–Ω—Ç–µ–∫—Å—Ç
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –¢–∞–±–ª–∏—Ü–∞ `chunks` –ø—É—Å—Ç–∞—è - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è RAG
2. –§—É–Ω–∫—Ü–∏—è `match_chunks_docs()` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. RAG –ø–æ–∏—Å–∫ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
4. OpenAI embeddings –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
const { data: chunks, count } = await supabase
  .from('chunks')
  .select('*', { count: 'exact', head: true });
console.log('Total chunks:', count);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏—é
const { data, error } = await supabase.rpc('match_chunks_docs', {
  query_embedding: testEmbedding,
  match_count: 3,
  roles: ['public'],
  min_similarity: 0.1
});
console.log('RPC test:', error ? error : `Found ${data?.length} results`);
```

**Migration user_chats.session_id not applied:**
**–ü—Ä–æ–±–ª–µ–º–∞:** `column user_chats.session_id does not exist`
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –≤ Supabase Dashboard:
```sql
ALTER TABLE user_chats ADD COLUMN IF NOT EXISTS session_id UUID DEFAULT gen_random_uuid();
CREATE UNIQUE INDEX IF NOT EXISTS idx_user_chats_session_id ON user_chats(session_id);
```
**–§–∞–π–ª:** `FIX_USER_CHATS_SESSION_ID.sql`

**RAG search returns empty results:**
**–ü—Ä–æ–±–ª–µ–º–∞:** match_chunks_docs() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. min_similarity —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π (0.7)
2. accessible_roles –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç 'public'
3. Embeddings –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–Ω–∏–∑–∏—Ç—å min_similarity –¥–æ 0.3 –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```typescript
const { data: matches } = await supabase.rpc('match_chunks_docs', {
  query_embedding: queryEmbedding,
  match_count: 5,
  roles: ['public'],  // –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å 'public'
  min_similarity: 0.3  // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–Ω–∏–∑–∏—Ç—å
});
```

---

## üöß –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 0.8.3 (continued) - 2025-10-03

### Knowledge Base Rebuild - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

#### **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã—è–≤–∏–ª–∞ –ø—Ä–æ–±–ª–µ–º—É:**
```
‚úÖ chunks —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç 303 –∑–∞–ø–∏—Å–∏
‚úÖ match_chunks_docs() —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
‚ùå RAG –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (similarity threshold 0.7)
‚ùì –°–æ—Å—Ç–æ—è–Ω–∏–µ embeddings –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
```

#### **–ü—Ä–∏–Ω—è—Ç—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

**1. Steward –¥–æ—Å—Ç—É–ø –∫ –∑–Ω–∞–Ω–∏—è–º:**
```
–¢–û–õ–¨–ö–û –ø—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
‚úì docs/charter/philosophy.md
‚úì docs/charter/roles.md
‚úì docs/charter/economics.md

–ò–°–ö–õ–Æ–ß–ï–ù–û:
‚úó docs/ai_agents/* (–ø—Ä–æ–º–ø—Ç—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤)
‚úó docs/spec/* (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
```

**2. –†–æ–ª–∏ –¥–æ—Å—Ç—É–ø–∞ (–ø–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ):**
```javascript
// –§–∞–∑–∞ 1 (—Å–µ–π—á–∞—Å):
'guest'      // –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
'public'     // –ò–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π—Å—è (–±–∞–∑–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
'passenger'  // –ü–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏

// –§–∞–∑–∞ 2 (–ø–æ–∑–∂–µ):
'sailor'     // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è
'captain'    // –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å
'partner'    // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø (–≤—Å—è –ë–ó)
```

**3. –ú–∞–ø–ø–∏–Ω–≥ —Ä–æ–ª–µ–π –Ω–∞ –¥–æ—Å—Ç—É–ø:**
```typescript
function mapUserRoleToKnowledgeRoles(userRole: string): string[] {
  const roleMap = {
    'guest': ['guest'],
    'public': ['guest', 'public'],
    'passenger': ['guest', 'public', 'passenger'],
    // –ü–æ–∑–∂–µ: sailor, captain, partner
  };
  return roleMap[userRole.toLowerCase()] || ['guest'];
}
```

#### **–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

**–ï–¥–∏–Ω—ã–π pipeline –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:**
```
1. –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ (GitHub repo docs/)
   ‚Üì
2. –°–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ (scripts/rebuild-steward-knowledge.mjs)
   - –ß–∞–Ω–∫–æ–≤–∞–Ω–∏–µ (600 tokens, overlap 100)
   - Embedding generation (OpenAI ada-002)
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (source, path, roles, tags)
   ‚Üì
3. chunks —Ç–∞–±–ª–∏—Ü–∞ —Å embeddings
   ‚Üì
4. RAG –ø–æ–∏—Å–∫ (match_chunks_docs)
   ‚Üì
5. Steward –æ—Ç–≤–µ—Ç—ã –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:**
```javascript
// scripts/rebuild-steward-knowledge.mjs

const STEWARD_SOURCES = [
  'docs/charter/philosophy.md',
  'docs/charter/roles.md',
  'docs/charter/economics.md'
];

const STEWARD_ROLES = ['guest', 'public', 'passenger'];

// –ü—Ä–æ—Ü–µ—Å—Å:
1. –û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ chunks –¥–ª—è Steward
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ STEWARD_SOURCES:
   - –ü–∞—Ä—Å–∏—Ç—å frontmatter
   - –ß–∞–Ω–∫–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
   - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å embeddings
   - Upsert –≤ chunks —Å accessible_roles = STEWARD_ROLES
3. –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ embeddings —Å–æ–∑–¥–∞–Ω—ã
4. –¢–µ—Å—Ç RAG –ø–æ–∏—Å–∫–∞
```

**–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç Steward:**
```typescript
const stewardPrompt = `–¢—ã - –®–∫–∏–ø–µ—Ä-–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä DAOsail, –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤.

üéØ –î–û–°–¢–£–ü –ö –ó–ù–ê–ù–ò–Ø–ú:
–£ —Ç–µ–±—è –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –±–∞–∑–æ–≤–æ–π –ø—É–±–ª–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
‚Ä¢ –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –º–∏—Å—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚Ä¢ –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚Ä¢ –û—Å–Ω–æ–≤—ã —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏

üìã –ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–û–í:
‚Ä¢ –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚Ä¢ –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ù–ï–¢ ‚Üí "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É –º–µ–Ω—è –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
‚Ä¢ –ù–ï –≤—ã–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã, –¥–∞—Ç—ã, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
‚Ä¢ –ú–æ–∂–µ—à—å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –Ω–æ —Å—Ç—Ä–æ–≥–æ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
‚Ä¢ –£–ø–æ–º–∏–Ω–∞–π –∏—Å—Ç–æ—á–Ω–∏–∫–∏ [1], [2] –∫–æ–≥–¥–∞ —É–º–µ—Å—Ç–Ω–æ

üé® –°–¢–ò–õ–¨:
‚Ä¢ –¢–æ–Ω: —Ç–µ–ø–ª—ã–π, –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π
‚Ä¢ –¢—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—à—å –Ω–æ–≤–∏—á–∫–æ–≤ –≤ DAOsail –∫–∞–∫ —Ö–æ—Ä–æ—à–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
‚Ä¢ –ü–æ–º–æ–≥–∞–µ—à—å —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –±–∞–∑–æ–≤—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏—è—Ö –ø—Ä–æ–µ–∫—Ç–∞

–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
${context}`;
```

#### **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–û–ñ–ò–î–ê–ù–ò–ï):**
```
‚è∏Ô∏è –ü–æ–ª—É—á–∏—Ç—å URL GitHub —Ä–µ–ø–æ —Å docs/ (–∏–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
‚è∏Ô∏è –†–µ—à–∏—Ç—å: –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
‚è∏Ô∏è –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç rebuild-steward-knowledge.mjs
‚è∏Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –ë–ó —Å embeddings
‚è∏Ô∏è –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RAG –ø–æ–∏—Å–∫
‚è∏Ô∏è –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ UI
```

---

## ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 0.8.3 (–ó–ê–í–ï–†–®–ï–ù–û) - 2025-10-04

### Knowledge Base Rebuild - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

#### **–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**

**1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:**
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω KB —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/ShkiperPartner/daosail-kb.git

# –°–æ–∑–¥–∞–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏
scripts/rebuild-steward-knowledge.mjs

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ KB (29 markdown —Ñ–∞–π–ª–æ–≤):
daosail-kb/docs/
‚îú‚îÄ‚îÄ charter/        # –£—Å—Ç–∞–≤, —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è, —Ä–æ–ª–∏
‚îú‚îÄ‚îÄ faq/            # –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ yachting/       # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —è—Ö—Ç–∏–Ω–≥–µ
‚îú‚îÄ‚îÄ decentralization/ # DAO —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îú‚îÄ‚îÄ gov/            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ ops/            # –û–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ playbook/       # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
‚îú‚îÄ‚îÄ spec/           # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ ai_agents/      # –ü—Ä–æ–º–ø—Ç—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
```

**2. –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è Steward (–ø—É–±–ª–∏—á–Ω–∞—è –ë–ó):**
```javascript
const STEWARD_SOURCES = [
  // –£—Å—Ç–∞–≤ –∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è
  'charter/philosophy.md',
  'charter/mission.md',
  'charter/roles.md',
  'charter/README.md',

  // FAQ –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤
  'faq/general.md',
  'faq/club.md',
  'faq/membership.md',
  'faq/yachting.md',
  'faq/dao.md',
  'faq/ai.md',
  'faq/README.md',

  // –Ø—Ö—Ç–∏–Ω–≥
  'yachting/README.md',
  'yachting/training.md',

  // –î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è
  'decentralization/dao.md'
];

const STEWARD_ROLES = ['guest', 'public', 'passenger'];
```

**3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏:**
```
‚úÖ 14 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
‚úÖ 17 chunks —Å embeddings –∑–∞–≥—Ä—É–∂–µ–Ω–æ
‚úÖ –†–æ–ª–∏ –¥–æ—Å—Ç—É–ø–∞: guest, public, passenger
‚úÖ –¢–∞–±–ª–∏—Ü–∞: chunks (source='steward-kb')
‚úÖ RPC —Ñ—É–Ω–∫—Ü–∏—è: match_chunks_docs() —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RAG –ø–æ–∏—Å–∫–∞:**
```
–í–æ–ø—Ä–æ—Å: "–ß—Ç–æ —Ç–∞–∫–æ–µ DAOsail?"
‚Üí Similarity: 90.7% (faq/club.md)
‚Üí Similarity: 89.9% (faq/general.md)
‚Üí Similarity: 88.6% (faq/README.md)

–í–æ–ø—Ä–æ—Å: "–ö–∞–∫–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∞?"
‚Üí Similarity: 80.3% (charter/philosophy.md)
‚Üí Similarity: 80.3% (charter/README.md)

–í–æ–ø—Ä–æ—Å: "–ö–∞–∫–∏–µ —Ä–æ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç?"
‚Üí Similarity: 88.9% (faq/membership.md)
‚Üí Similarity: 88.0% (charter/roles.md)
```

**5. UI –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
‚úÖ Steward –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ë–ó
‚úÖ Citations –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚ö†Ô∏è –û—Ç–≤–µ—Ç—ã –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–µ (—á–∞–Ω–∫–∏ –º–∞–ª–µ–Ω—å–∫–∏–µ)
‚ö†Ô∏è –ù–∏–∑–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ DAOsail –∫–∞–∫ "–∫–ª—É–±–∞ –¥–≤—É—Ö —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–µ–π"
```

#### **–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞:**

**–ü—Ä–æ–±–ª–µ–º–∞: –°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–µ —á–∞–Ω–∫–∏**
```
–ü—Ä–∏—á–∏–Ω–∞: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Üí 1 chunk
–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ: –¢–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≥–ª—É–±–∏–Ω–∞
–ü—Ä–∏–º–µ—Ä: "–ß—Ç–æ —Ç–∞–∫–æ–µ DAOsail?" ‚Üí –æ–±—â–∏–π –æ—Ç–≤–µ—Ç –ø—Ä–æ —è—Ö—Ç-–∫–ª—É–±
         –≤–º–µ—Å—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ "–∫–ª—É–±–∞ –¥–≤—É—Ö —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–µ–π"
```

**–†–µ—à–µ–Ω–∏–µ (–¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏):**
```javascript
// –£–≤–µ–ª–∏—á–∏—Ç—å chunk size
chunkSize: 600 ‚Üí 1200 tokens

// –î–æ–±–∞–≤–∏—Ç—å semantic chunking
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–º—ã—Å–ª–æ–≤—ã–º –±–ª–æ–∫–∞–º
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ —á–∞–Ω–∫–∞—Ö
- Overlap —Å –∫–ª—é—á–µ–≤—ã–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏

// –û–±–æ–≥–∞—â–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
metadata: {
  section: 'Philosophy',
  concepts: ['DAO', '–¥–≤–æ–π–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å', 'Web3'],
  importance: 'high'
}
```

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ v0.8.3:

#### **Knowledge Base Loading Pattern:**
```javascript
// scripts/rebuild-steward-knowledge.mjs

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (STEWARD_SOURCES)
2. –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ chunks (source='steward-kb')
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:
   - –ß–∏—Ç–∞—Ç—å markdown
   - –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ß–∞–Ω–∫–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç (600 tokens, overlap 100)
   - –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å embeddings (OpenAI ada-002)
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (roles, tags, path)
4. Batch upload –≤ chunks —Ç–∞–±–ª–∏—Ü—É
5. –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ RPC test
```

#### **Role-Based Knowledge Access:**
```typescript
// –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–æ–ª–µ–π –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –ë–ó
const getAccessibleRoles = (userRole: string): string[] => {
  const roleHierarchy: Record<string, string[]> = {
    '–ò–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π—Å—è': ['public'],
    '–ü–∞—Å—Å–∞–∂–∏—Ä': ['public', 'passenger'],
    '–ú–∞—Ç—Ä–æ—Å': ['public', 'passenger', 'sailor'],
    '–ü–∞—Ä—Ç–Ω–µ—Ä': ['public', 'passenger', 'sailor', 'partner'],
    'admin': ['public', 'passenger', 'sailor', 'partner', 'admin']
  };
  return roleHierarchy[role] || ['public'];
};
```

#### **Chunking Strategy:**
```javascript
function chunkText(text, chunkSize, overlap) {
  const words = text.split(/\s+/);
  const chunks = [];

  for (let i = 0; i < words.length; i += chunkSize - overlap) {
    const chunk = words.slice(i, i + chunkSize).join(' ');
    if (chunk.trim()) {
      chunks.push(chunk.trim());
    }
  }

  return chunks;
}
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è v0.8.3:

**Embeddings –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è:**
**–ü—Ä–æ–±–ª–µ–º–∞:** OpenAI API –∫–ª—é—á –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:**
```bash
OPENAI_API_KEY=sk-... node scripts/rebuild-steward-knowledge.mjs
```

**RAG –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
**–ü—Ä–æ–±–ª–µ–º–∞:** similarity threshold —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–Ω–∏–∑–∏—Ç—å min_similarity —Å 0.7 –¥–æ 0.3 –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```typescript
const { data: matches } = await supabase.rpc('match_chunks_docs', {
  query_embedding,
  match_count: 5,
  roles: ['public'],
  min_similarity: 0.3  // –í–º–µ—Å—Ç–æ 0.7
});
```

**–û—Ç–≤–µ—Ç—ã Steward –Ω–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è DAOsail:**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ß–∞–Ω–∫–∏ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–µ, —Ç–µ—Ä—è–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
**–†–µ—à–µ–Ω–∏–µ (TODO):**
- –£–≤–µ–ª–∏—á–∏—Ç—å chunk size –¥–æ 1200 tokens
- Semantic chunking –ø–æ —Å–º—ã—Å–ª–æ–≤—ã–º –±–ª–æ–∫–∞–º
- –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –≤ metadata

---

*–≠—Ç–æ—Ç —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–ø—Ä–∏–Ω—Ç–∞*
*–¶–µ–ª—å: —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏*
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-10-04 (v0.8.3 Steward KB + Claude 4.5 capabilities –æ—Ç 2025-01-31)*
