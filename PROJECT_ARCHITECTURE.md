# Project Architecture Overview

**–ü—Ä–æ–µ–∫—Ç:** DAOsail Prototype - Next.js App
**–í–µ—Ä—Å–∏—è:** 0.4.0
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-09-15
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ - Phase 4.1 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (AI Integration)

---

## üìä Technology Stack

### Frontend
- **Framework:** Next.js 13.5.1 + React 18 + TypeScript
- **State Management:** React Context API (AppContext)
- **UI/CSS:** Tailwind CSS + Radix UI + Lucide React icons
- **Routing:** Next.js App Router (app/ directory)
- **Themes:** next-themes –¥–ª—è dark/light mode

### Backend & Infrastructure
- **Database:** Supabase (PostgreSQL + Real-time + Storage)
- **Authentication:** Supabase Auth —Å Email/Password
- **API:** Supabase REST API + TypeScript SDK
- **Storage:** Supabase Storage –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Static Data:** Mock –¥–∞–Ω–Ω—ã–µ + —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
- **Persistence:** Supabase + localStorage –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **Real-time:** Supabase Realtime –¥–ª—è live –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **Future:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DAO –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏

### Key Dependencies
```json
{
  "next": "15.5.3",
  "react": "18.2.0",
  "typescript": "5.2.2",
  "@radix-ui/*": "—Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ UI primitives",
  "lucide-react": "^0.446.0",
  "tailwindcss": "3.3.3",
  "next-themes": "^0.3.0",
  "@supabase/supabase-js": "^2.x.x",
  "@supabase/ssr": "^0.x.x",
  "openai": "^4.x.x"
}
```

### AI & ML Stack
- **LLM Model:** OpenAI GPT-4o-mini –¥–ª—è —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã—Ö, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- **Embeddings:** OpenAI text-embedding-ada-002 –¥–ª—è vector –ø–æ–∏—Å–∫–∞
- **Vector Database:** Supabase pgvector extension
- **RAG System:** Retrieval-Augmented Generation —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
- **Knowledge Base:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–∞—Ä—É—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π

---

## üóÇÔ∏è Project Structure

```
app/
‚îú‚îÄ‚îÄ (auth)/               # Auth layout group
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx        # Layout –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ login/            # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ signup/           # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ (main)/               # Main layout group
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx        # –û—Å–Ω–æ–≤–Ω–æ–π layout —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx          # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ chat/             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞ —Å –ò–ò
‚îÇ   ‚îú‚îÄ‚îÄ community/        # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ dao/              # –°—Ç—Ä–∞–Ω–∏—Ü–∞ DAO —Ñ—É–Ω–∫—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ library/          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ profile/          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è —Å —Ç–∞–±–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ tutorial/         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ api/                  # API Routes
‚îÇ   ‚îú‚îÄ‚îÄ chat/             # OpenAI —á–∞—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ search-knowledge/ # –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
‚îú‚îÄ‚îÄ layout.tsx            # Root layout
‚îî‚îÄ‚îÄ globals.css           # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏

components/
‚îú‚îÄ‚îÄ layout/               # Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ left-sidebar.tsx  # –õ–µ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ right-sidebar.tsx # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–∞–≤—ã–π —Å–∞–π–¥–±–∞—Ä (–≥–æ—Å—Ç—å/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ top-bar.tsx       # –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ footer.tsx        # –ü–æ–¥–≤–∞–ª
‚îÇ   ‚îî‚îÄ‚îÄ mobile-drawer.tsx # –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
‚îú‚îÄ‚îÄ profile/              # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ profile-sidebar.tsx    # –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–∞–π–¥–±–∞—Ä
‚îÇ   ‚îú‚îÄ‚îÄ profile-info-tab.tsx   # –í–∫–ª–∞–¥–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è + –∞–≤–∞—Ç–∞—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ my-path-tab.tsx        # –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ achievements-tab.tsx   # –í–∫–ª–∞–¥–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
‚îî‚îÄ‚îÄ ui/                   # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ hero-card.tsx     # –ì–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
    ‚îú‚îÄ‚îÄ chat-box.tsx      # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞
    ‚îú‚îÄ‚îÄ quick-questions.tsx # –ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã
    ‚îú‚îÄ‚îÄ avatar-upload.tsx # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
    ‚îî‚îÄ‚îÄ ...               # –î—Ä—É–≥–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

lib/
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îî‚îÄ‚îÄ app-context.tsx   # –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase
‚îú‚îÄ‚îÄ supabase/             # Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ client.ts         # Supabase client
‚îÇ   ‚îú‚îÄ‚îÄ server.ts         # Server-side client
‚îÇ   ‚îú‚îÄ‚îÄ types.ts          # TypeScript —Ç–∏–ø—ã –¥–ª—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ profile-service.ts # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ + real-time
‚îú‚îÄ‚îÄ services/             # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ achievement-service.ts # –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ chat-service.ts   # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenAI API
‚îÇ   ‚îî‚îÄ‚îÄ embedding-service.ts # –†–∞–±–æ—Ç–∞ —Å vector embeddings
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ profile.ts        # –¢–∏–ø—ã –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ roles.ts          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–æ–ª–µ–π –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
‚îî‚îÄ‚îÄ utils.ts              # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã

data/
‚îú‚îÄ‚îÄ chat-messages.ts      # Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è —á–∞—Ç–∞
‚îî‚îÄ‚îÄ mock-profile.ts       # Mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

supabase/                 # Supabase CLI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ 001_create_profiles_schema.sql
‚îÇ   ‚îî‚îÄ‚îÄ 002_setup_vector_embeddings.sql
‚îú‚îÄ‚îÄ config.toml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase CLI
‚îî‚îÄ‚îÄ seed.sql             # –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ + –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
```

---

## üèóÔ∏è Core Architecture Decisions

### 1. UI Architecture: Radix UI + Tailwind CSS

**–†–µ—à–µ–Ω–∏–µ:** Radix UI primitives + Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –í—ã—Å–æ–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (accessibility) –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –ì–∏–±–∫–∞—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Tailwind
- ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (composable components)
- ‚úÖ TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã:**
- ‚ùå Material UI - —Å–ª–∏—à–∫–æ–º –æ–ø–∏–Ω–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚ùå Chakra UI - –º–µ–Ω—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–µ–π

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```typescript
// –ü—Ä–∏–º–µ—Ä Radix UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';

export function MyComponent() {
  return (
    <Card className="p-4">
      <CardContent>
        <Button variant="outline">Action</Button>
      </CardContent>
    </Card>
  );
}
```

### 2. State Management: React Context API

**–†–µ—à–µ–Ω–∏–µ:** React Context API –≤–º–µ—Å—Ç–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ React, –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö/—Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- ‚úÖ TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚úÖ –õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. Routing: Next.js App Router

**–†–µ—à–µ–Ω–∏–µ:** App Router (app/) –≤–º–µ—Å—Ç–æ Pages Router  
**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ Next.js 13+
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ layouts –∏ nested routing
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ Server Components –ø–æ–¥–¥–µ—Ä–∂–∫–∞

---

## üîß Key Services & Components

### App Context (lib/contexts/app-context.tsx)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
interface AppContextType {
  theme: 'light' | 'dark';
  language: 'en' | 'ru';
  responsesLeft: number;
  isAuthenticated: boolean;
  toggleTheme: () => void;
  toggleLanguage: () => void;
  decrementResponses: () => void;
  resetResponses: () => void;
  setAuthenticated: (value: boolean) => void;
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ localStorage
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã –∫ document
- –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å ru/en
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### UI Components (components/ui/)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –±–∞–∑–µ Radix UI  
**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `HeroCard` ‚Üí –≥–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- `ChatBox` ‚Üí –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞ —Å mock AI responses
- `QuickQuestions` ‚Üí –±—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–∏–∞–ª–æ–≥–∞
- `SoftGateBanner` ‚Üí –±–∞–Ω–Ω–µ—Ä —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π

**–ü–∞—Ç—Ç–µ—Ä–Ω—ã:**
```typescript
// –ü—Ä–∏–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π
export function MyComponent() {
  const { language } = useAppContext();
  
  return (
    <div>
      {language === 'ru' ? '–¢–µ–∫—Å—Ç' : 'Text'}
    </div>
  );
}
```

### Layout System (components/layout/)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `LeftSidebar` ‚Üí –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
- `RightSidebar` ‚Üí –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `TopBar` ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ç–µ–º—ã/—è–∑—ã–∫–∞
- `Footer` ‚Üí –ø–æ–¥–≤–∞–ª —Å–∞–π—Ç–∞
- `MobileDrawer` ‚Üí –º–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

### ProfileService (lib/supabase/profile-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- getFullProfile(userId) ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- transformToAppProfile() ‚Üí –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ Supabase –≤ —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- updateProfile() / updateStats() ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- incrementStat() ‚Üí –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- uploadAvatar() ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤ –≤ Supabase Storage
- checkAndPromoteRole() ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–æ–ª–µ–π
- subscribeToProfile() ‚Üí real-time –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
```

### AchievementService (lib/services/achievement-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- checkAndAddAchievements() ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- getAllTemplates() ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- getProgressForAchievement() ‚Üí —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- 12 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö:
  * engagement (–≤–æ–ø—Ä–æ—Å—ã, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
  * learning (—É—Ä–æ–∫–∏, —Å—Ç–∞—Ç—å–∏)
  * social (—Å–æ–æ–±—â–µ—Å—Ç–≤–æ)
  * progression (–ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–æ–ª–µ–π)
  * special (–æ—Å–æ–±—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è)
```

### AvatarUpload Component (components/ui/avatar-upload.tsx)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- Drag & Drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (—Ç–∏–ø, —Ä–∞–∑–º–µ—Ä –¥–æ 5MB)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Storage
- Responsive –¥–∏–∑–∞–π–Ω –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

### ChatService (lib/services/chat-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- sendMessage() ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫ GPT-4o-mini —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- createChatSession() ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π —á–∞—Ç–∞
- getChatSessions() ‚Üí –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- validateMessage() ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- generateChatTitle() ‚Üí –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —á–∞—Ç–∞
- getQuickQuestions() ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –±—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
```

### EmbeddingService (lib/services/embedding-service.ts)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** RAG —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
```typescript
- searchKnowledgeBase() ‚Üí —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- addKnowledgeDocument() ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- getDocumentsByCategory() ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- getContextForAI() ‚Üí —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ò–ò
- Vector embeddings —á–µ—Ä–µ–∑ OpenAI text-embedding-ada-002
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase pgvector –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

### OpenAI API Integration
**API Routes:**
- `/api/chat` ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç —Å GPT-4o-mini + RAG
- `/api/search-knowledge` ‚Üí –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã:**
- **–ù–∞–≤–∏–≥–∞—Ç–æ—Ä** ‚Üí –æ—Å–Ω–æ–≤—ã –ø–∞—Ä—É—Å–Ω–æ–≥–æ —Å–ø–æ—Ä—Ç–∞, –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –ø–æ–≥–æ–¥–∞, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
- **–®–∫–∏–ø–µ—Ä** ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫–∏–ø–∞–∂–µ–º, –∞–≤–∞—Ä–∏–π–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏, —Ä–µ–≥–∞—Ç—ã

### Mock Data (data/)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Fallback –¥–∞–Ω–Ω—ã–µ (–±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —á–∞—Ç–µ)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `mock-profile.ts` ‚Üí fallback –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üì° Data Flow & Integration Patterns

### 1. Theme Switching Flow
```
User Click ‚Üí toggleTheme() in AppContext ‚Üí
‚îú‚îÄ‚îÄ Update theme state ('light' | 'dark')
‚îú‚îÄ‚îÄ Apply to document.documentElement.classList
‚îú‚îÄ‚îÄ Save to localStorage
‚îî‚îÄ‚îÄ Re-render with new theme
```

### 2. Language Switching Flow
```
User Click ‚Üí toggleLanguage() in AppContext ‚Üí
‚îú‚îÄ‚îÄ Update language state ('en' | 'ru')
‚îú‚îÄ‚îÄ Save to localStorage
‚îú‚îÄ‚îÄ Re-render all components with new language
‚îî‚îÄ‚îÄ Update all UI text accordingly
```

### 3. Chat Message Flow (Mock)
```
User Input ‚Üí ChatBox.handleSend() ‚Üí
‚îú‚îÄ‚îÄ Check responsesLeft limit
‚îú‚îÄ‚îÄ Add user message to local state
‚îú‚îÄ‚îÄ Show typing indicator
‚îú‚îÄ‚îÄ Simulate AI response (setTimeout)
‚îú‚îÄ‚îÄ Add AI response to messages
‚îú‚îÄ‚îÄ decrementResponses() in context
‚îî‚îÄ‚îÄ Update UI state
```

### 4. Navigation Flow
```
User Click ‚Üí Next.js Link ‚Üí
‚îú‚îÄ‚îÄ App Router handles routing
‚îú‚îÄ‚îÄ Load appropriate page.tsx
‚îú‚îÄ‚îÄ Maintain layout from layout.tsx
‚îî‚îÄ‚îÄ Update URL and browser history
```

---

## üéØ Development Standards

### Code Organization
- **1 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç = 1 —Ñ–∞–π–ª**
- **–°–µ—Ä–≤–∏—Å—ã –≤ lib/** –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **TypeScript —Å—Ç—Ä–æ–≥–∏–π** - no any (–∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π)
- **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ:** camelCase –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, PascalCase –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### Database Patterns  
- **UUID** –¥–ª—è –≤—Å–µ—Ö Primary Keys
- **JSONB** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- **RLS** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫
- **–ú–∏–≥—Ä–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ scripts —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### Error Handling
- **Try/catch** –≤ async —Ñ—É–Ω–∫—Ü–∏—è—Ö
- **User-friendly** —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **–ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **Fallback —Å–æ—Å—Ç–æ—è–Ω–∏—è** –≤ UI

### Performance Optimizations  
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π polling** OpenAI API
- **Zustand selective subscriptions**
- **GIN –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è JSONB queries
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ re-renders** –≤ React

---

## üìã Current Implementation Status

### ‚úÖ –ì–æ—Ç–æ–≤–æ (v0.4.0 - AI Integration Complete)
**Phase 1: Basic Prototype**
- [x] Next.js 15 App Router —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [x] Radix UI + Tailwind CSS –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞
- [x] –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å (ru/en) —á–µ—Ä–µ–∑ AppContext
- [x] –¢–µ–º–∏–∑–∞—Ü–∏—è (light/dark) —Å next-themes
- [x] Responsive –¥–∏–∑–∞–π–Ω –¥–ª—è mobile/desktop
- [x] Mock —á–∞—Ç —Å –ò–ò (–∏–º–∏—Ç–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–∞)
- [x] –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∞–º
- [x] Soft gate –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**Phase 2: Authentication & Profiles**
- [x] Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- [x] –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Email/Password)
- [x] –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—Ö–æ–¥–∞
- [x] –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π —Å —Ä–æ–ª—è–º–∏ (–ò–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π—Å—è ‚Üí –ü–∞—Å—Å–∞–∂–∏—Ä ‚Üí –ú–∞—Ç—Ä–æ—Å)
- [x] –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- [x] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
- [x] –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–∞–π–¥–±–∞—Ä —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
- [x] –¢–∞–±–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ—Ñ–∏–ª—è (–ü—Ä–æ—Ñ–∏–ª—å / –ú–æ–π –ü—É—Ç—å / –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è)

**Phase 3: Database & Services (–ó–∞–≤–µ—Ä—à–µ–Ω–∞)**
- [x] Supabase CLI –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- [x] –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (profiles, user_stats, user_achievements, user_chats)
- [x] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] ProfileService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- [x] TypeScript —Ç–∏–ø—ã –¥–ª—è Supabase –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [x] Supabase Storage –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ProfileService —Å AppContext
- [x] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞–º–∏ (AvatarUpload)
- [x] Real-time —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ä–æ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [x] AchievementService —Å 12 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏
- [x] Seed –¥–∞–Ω–Ω—ã–µ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**Phase 4: AI Integration & Advanced Features (–í –ø—Ä–æ—Ü–µ—Å—Å–µ)**
- [x] **OpenAI API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - GPT-4o-mini —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —á–∞—Ç–∞
- [x] **RAG —Å–∏—Å—Ç–µ–º–∞** - Vector embeddings —Å Supabase pgvector
- [x] **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–∞—Ä—É—Å–Ω–æ–º—É —Å–ø–æ—Ä—Ç—É
- [x] **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã** - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä –∏ –®–∫–∏–ø–µ—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
- [x] **–†–µ–∞–ª—å–Ω—ã–π —á–∞—Ç** - –ó–∞–º–µ–Ω–∞ mock –¥–∞–Ω–Ω—ã—Ö –Ω–∞ OpenAI API
- [x] **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –¥–ª—è —Ç–æ—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- [x] **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- [ ] **Streaming responses** - –ü–æ—Ç–æ–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ UX
- [ ] **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤** –≤ Supabase
- [ ] File upload –∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º (–¥–æ–∫—É–º–µ–Ω—Ç—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- [ ] Function calling –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
- [ ] Export/import —á–∞—Ç–æ–≤
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö (toast notifications)
- [ ] –°–∏—Å—Ç–µ–º–∞ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤ –∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- [ ] –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–¥—Ä—É–∑—å—è, –≥—Ä—É–ø–ø—ã)

### üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è (Phase 5: DAO & Advanced Features)
- [ ] DAO —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ä—É—Å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏
- [ ] API –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üîÑ Evolution & Migration Strategy

### –ü–æ–¥—Ö–æ–¥ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
1. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ** –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
2. **Database changes** ‚Üí DATABASE_CHANGELOG.md
3. **Backward compatibility** –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ
4. **Feature flags** –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### Migration Pattern
```
Planning ‚Üí Implementation ‚Üí Testing ‚Üí Documentation ‚Üí Deployment
    ‚Üì           ‚Üì              ‚Üì           ‚Üì            ‚Üì
  This file  Code+Tests    Manual QA   Update docs   Git push
```

---

## üóÑÔ∏è Database Schema Overview

### Supabase Tables Structure
```sql
-- –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
profiles (id, full_name, nickname, avatar_url, city, bio, role, join_date, timestamps)

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
user_stats (id, questions_asked, lessons_completed, articles_read, community_messages, last_login_date, total_logins, timestamps)

-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
user_achievements (id, user_id, achievement_id, title, title_ru, description, description_ru, icon_name, category, unlocked_at, timestamps)

-- –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤
user_chats (id, user_id, title, assistant_type, main_topic, messages_count, last_activity, timestamps)

-- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å vector embeddings (NEW!)
knowledge_documents (
  id, title, content, source_type, source_url, file_path,
  language, category, embedding vector(1536), timestamps
)
```

### Vector Search & RAG System
- **pgvector extension** –≤–∫–ª—é—á–µ–Ω –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **Embeddings model** OpenAI text-embedding-ada-002 (1536 dimensions)
- **Search function** search_knowledge_documents() —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –ø–æ—Ä–æ–≥–æ–º similarity
- **Categories** sailing_basics, navigation, safety, weather, equipment, racing, etc.
- **Languages** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ru/en –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### Storage Buckets
- **avatars** - –ê–≤–∞—Ç–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏

### Real-time Features
- Live –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

---

## üéâ Phase 4.1 Completion Summary

**–§–∞–∑–∞ 4.1: AI Integration** —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (2025-09-15)

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
1. **ü§ñ OpenAI API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - GPT-4o-mini —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —á–∞—Ç–∞
2. **üß† RAG —Å–∏—Å—Ç–µ–º–∞** - Vector embeddings + Supabase pgvector –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
3. **üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø–∞—Ä—É—Å–Ω–æ–º—É —Å–ø–æ—Ä—Ç—É
4. **‚öì –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã** - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä –∏ –®–∫–∏–ø–µ—Ä —Å —Ä–∞–∑–Ω–æ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π
5. **üí¨ –†–µ–∞–ª—å–Ω—ã–π —á–∞—Ç** - –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ mock –¥–∞–Ω–Ω—ã—Ö –Ω–∞ OpenAI API
6. **üìä Smart —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —á–∞—Ç–∞

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **ChatService** - –ü–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenAI API
- **EmbeddingService** - RAG —Å–∏—Å—Ç–µ–º–∞ —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º
- **API Routes** - `/api/chat` –∏ `/api/search-knowledge` –¥–ª—è backend –ª–æ–≥–∏–∫–∏
- **Vector Database** - pgvector extension —Å optimized –ø–æ–∏—Å–∫–æ–º
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã** - –ò–ò –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–≤–æ–¥–∞
- **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π UI** - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- **–ù–∞—Å—Ç–æ—è—â–∏–µ –æ—Ç–≤–µ—Ç—ã** –æ—Ç GPT-4o-mini –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –ø–∞—Ä—É—Å–Ω–æ–º—É —Å–ø–æ—Ä—Ç—É
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç—å** - –ò–ò –∑–Ω–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –ø–∞—Ä—É—Å–Ω–æ–≥–æ —Å–ø–æ—Ä—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–î–≤–∞ —Ç–∏–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤** - –ù–∞–≤–∏–≥–∞—Ç–æ—Ä –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤, –®–∫–∏–ø–µ—Ä –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö
- **–°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤** - –ì–æ—Å—Ç–∏ –ø–æ–ª—É—á–∞—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —á–∞—Ç–µ

### üìä –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ Phase 4.2:
- Streaming responses –¥–ª—è –ª—É—á—à–µ–≥–æ UX
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –≤ Supabase
- File upload —Å–∏—Å—Ç–µ–º–∞
- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π

---

*–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏*
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-09-15 (Phase 4.1 Complete - AI Integration)*